# ==========================================
# TRAVIAN T4.6 - PRODUCTION CONFIGURATION
# ==========================================
# Windows 11/WSL2/Docker Deployment
# Dual-Database Architecture + AI-NPC System
# ==========================================
#
# üîê SECURITY NOTICE:
# This is a TEMPLATE file - DO NOT use these values in production!
# 
# SETUP INSTRUCTIONS:
# 1. Generate secure .env file: ./scripts/secrets/generate-env.sh production
# 2. Validate configuration: ./scripts/secrets/validate-env.sh .env.production
# 3. Audit for leaks: ./scripts/secrets/audit-secrets.sh
#
# CREDENTIAL ROTATION:
# - Database passwords: Rotate every 90 days minimum
# - API keys: Rotate every 180 days or when compromised
# - JWT secrets: Rotate every 365 days or when compromised
# - Run: ./scripts/secrets/rotate-credentials.sh [service]
#
# NEVER commit .env files to version control!
# ==========================================

# ==========================================
# ENVIRONMENT
# ==========================================
APP_ENV=production
APP_DEBUG=false
APP_URL=https://yourdomain.com
NODE_ENV=production

# ==========================================
# TLS/SSL CONFIGURATION
# ==========================================
# Domain for Let's Encrypt certificate
# üîê IMPORTANT: Must point to your server's IP address
# üìù VALIDATION: DNS A record must resolve before certificate issuance
DOMAIN=yourdomain.com

# Email for Let's Encrypt notifications (certificate expiry, renewals)
# üîí IMPORTANT: Use a monitored email address
# üìß PURPOSE: Let's Encrypt will send expiry notices if auto-renewal fails
LETSENCRYPT_EMAIL=admin@yourdomain.com

# ==========================================
# POSTGRESQL (Global DB + AI-NPC Tables)
# ==========================================
# üîí ROTATION: Every 90 days minimum
# üìè LENGTH: Minimum 64 characters
# üîê GENERATION: openssl rand -base64 96 | tr -d '\n' | head -c 64
# ‚öôÔ∏è  ROTATION SCRIPT: ./scripts/secrets/rotate-credentials.sh postgres
DATABASE_URL=postgresql://postgres:CHANGE_ME_POSTGRES_PASSWORD@postgres:5432/travian_global

POSTGRES_PASSWORD=CHANGE_ME_POSTGRES_PASSWORD
PGHOST=postgres
PGPORT=5432
PGUSER=postgres
PGPASSWORD=CHANGE_ME_POSTGRES_PASSWORD
PGDATABASE=travian_global

# ==========================================
# MYSQL (Game World Databases)
# ==========================================
# üîí ROTATION: Every 90 days minimum
# üìè LENGTH: Minimum 64 characters
# üîê GENERATION: openssl rand -base64 96 | tr -d '\n' | head -c 64
# ‚öôÔ∏è  ROTATION SCRIPT: ./scripts/secrets/rotate-credentials.sh mysql
MYSQL_HOST=mysql
MYSQL_PORT=3306
MYSQL_ROOT_PASSWORD=CHANGE_ME_MYSQL_ROOT_PASSWORD
MYSQL_USER=travian_user
MYSQL_PASSWORD=CHANGE_ME_MYSQL_USER_PASSWORD

# Game World Databases (auto-created):
#   - travian_global (global settings)
#   - travian_testworld (test world 100x speed)
#   - travian_demo (demo world 5x speed)

# ==========================================
# REDIS (Caching & Sessions)
# ==========================================
# üîí ROTATION: Every 90 days minimum
# üìè LENGTH: Minimum 64 characters
# üîê GENERATION: openssl rand -base64 96 | tr -d '\n' | head -c 64
# ‚öôÔ∏è  ROTATION SCRIPT: ./scripts/secrets/rotate-credentials.sh redis
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=CHANGE_ME_REDIS_PASSWORD

# ==========================================
# EMAIL CONFIGURATION (Brevo/SendinBlue)
# ==========================================
# üîí ROTATION: Every 180 days or when compromised
# üìè LENGTH: API keys are typically 64+ characters
# üîê GENERATION: Obtain from Brevo dashboard (https://app.brevo.com)
# üìù VALIDATION: Starts with 'xkeysib-' prefix
# ‚ö†Ô∏è  IMPORTANT: Test email delivery after setup

# Option 1: Brevo API (Recommended)
BREVO_API_KEY=CHANGE_ME_BREVO_API_KEY
BREVO_SMTP_KEY=CHANGE_ME_BREVO_SMTP_KEY

# Option 2: Generic SMTP
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USERNAME=noreply@yourdomain.com
SMTP_PASSWORD=CHANGE_ME_SMTP_PASSWORD
SMTP_FROM_EMAIL=noreply@yourdomain.com
SMTP_FROM_NAME=Travian Game Server

# ==========================================
# SECURITY
# ==========================================
# üîí ROTATION: Every 180 days or when compromised
# üîê GENERATION: Obtain from Google reCAPTCHA Admin (https://www.google.com/recaptcha/admin)
# üìù VALIDATION: Public key starts with '6L', Private key starts with '6L'

# reCAPTCHA v2
RECAPTCHA_PUBLIC_KEY=CHANGE_ME_RECAPTCHA_PUBLIC_KEY
RECAPTCHA_PRIVATE_KEY=CHANGE_ME_RECAPTCHA_PRIVATE_KEY

# JWT Secret for API Authentication
# üîí ROTATION: Every 365 days or immediately if compromised
# üìè LENGTH: Minimum 64 characters (recommended)
# üîê GENERATION: openssl rand -base64 96 | tr -d '\n' | head -c 64
# ‚öôÔ∏è  ROTATION SCRIPT: ./scripts/secrets/rotate-credentials.sh jwt
# ‚ö†Ô∏è  WARNING: Rotating JWT secret invalidates all existing tokens!
JWT_SECRET=CHANGE_ME_RANDOM_JWT_SECRET_MIN_32_CHARS

# Session Configuration
SESSION_DRIVER=redis
SESSION_LIFETIME=360

# ==========================================
# LLM BACKEND CONFIGURATION
# ==========================================
# Primary LLM Backend (ollama, vllm, lm_studio, text_gen_webui, openai)
LLM_BACKEND=ollama

# Ollama Configuration
OLLAMA_HOST=http://ollama:11434
OLLAMA_MODEL=llama2:7b-chat

# vLLM Configuration
VLLM_HOST=http://vllm:8000
VLLM_MODEL=meta-llama/Llama-2-7b-chat-hf

# LM Studio Configuration
LM_STUDIO_HOST=http://host.docker.internal:1234
LM_STUDIO_MODEL=local-model

# Text Gen WebUI Configuration
TEXT_GEN_WEBUI_HOST=http://host.docker.internal:5000
TEXT_GEN_WEBUI_MODEL=TheBloke/Llama-2-7B-Chat-GGUF

# OpenAI Configuration (fallback)
# üîí ROTATION: Every 180 days or when compromised
# üìè LENGTH: API keys start with 'sk-' and are ~51 characters
# üîê GENERATION: Obtain from OpenAI Platform (https://platform.openai.com/api-keys)
# üí∞ IMPORTANT: Monitor usage to prevent unexpected costs
OPENAI_API_KEY=CHANGE_ME_OPENAI_API_KEY
OPENAI_MODEL=gpt-3.5-turbo

# LLM Performance Settings
LLM_MAX_TOKENS=512
LLM_TEMPERATURE=0.7
LLM_TIMEOUT=30
LLM_MAX_RETRIES=3

# Circuit Breaker Settings
LLM_CIRCUIT_BREAKER_THRESHOLD=5
LLM_CIRCUIT_BREAKER_TIMEOUT=60

# Response Caching
LLM_CACHE_ENABLED=true
LLM_CACHE_TTL=3600

# ==========================================
# GPU CONFIGURATION
# ==========================================
# NVIDIA GPU Settings (for LLM backends)
CUDA_VISIBLE_DEVICES=0
GPU_MEMORY_UTILIZATION=0.9

# Multiple GPUs (comma-separated)
# CUDA_VISIBLE_DEVICES=0,1,2

# ==========================================
# WORKER CONFIGURATION
# ==========================================
# Background Worker Settings
WORKER_AUTOMATION_ENABLED=true
WORKER_AI_DECISION_ENABLED=true
WORKER_SPAWN_SCHEDULER_ENABLED=true

# Worker Intervals (in seconds)
WORKER_AUTOMATION_INTERVAL=300        # 5 minutes
WORKER_AI_DECISION_INTERVAL=300       # 5 minutes
WORKER_SPAWN_SCHEDULER_INTERVAL=900   # 15 minutes

# Worker Heartbeat TTLs (in seconds)
WORKER_AUTOMATION_HEARTBEAT_TTL=600
WORKER_AI_DECISION_HEARTBEAT_TTL=600
WORKER_SPAWN_SCHEDULER_HEARTBEAT_TTL=1800

# ==========================================
# AI-NPC SYSTEM CONFIGURATION
# ==========================================
# NPC Spawning
NPC_SPAWN_ENABLED=true
NPC_DEFAULT_PRESET=medium  # low (25), medium (100), high (250)
NPC_SPAWN_ALGORITHM=quadrant_balanced  # quadrant_balanced, random_scatter, kingdom_clustering

# AI Decision Engine
AI_DECISION_RULE_BASED_PERCENTAGE=95
AI_DECISION_LLM_PERCENTAGE=5
AI_DECISION_MAX_RESPONSE_TIME_MS=200

# Automation Profiles
AUTOMATION_FARMING_ENABLED=true
AUTOMATION_BUILDING_ENABLED=true
AUTOMATION_TRAINING_ENABLED=true
AUTOMATION_DEFENSE_ENABLED=true
AUTOMATION_LOGISTICS_ENABLED=true
AUTOMATION_AWAY_MODE_ENABLED=true

# ==========================================
# PHP-FPM CONFIGURATION
# ==========================================
PHP_FPM_MAX_CHILDREN=50
PHP_FPM_START_SERVERS=10
PHP_FPM_MIN_SPARE_SERVERS=5
PHP_FPM_MAX_SPARE_SERVERS=35

# ==========================================
# NGINX CONFIGURATION
# ==========================================
NGINX_WORKER_PROCESSES=auto
NGINX_WORKER_CONNECTIONS=1024

# ==========================================
# MONITORING (Prometheus & Grafana)
# ==========================================
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090

GRAFANA_ENABLED=true
GRAFANA_PORT=3000
GRAFANA_ADMIN_USER=admin
# üîí ROTATION: Every 90 days minimum
# üìè LENGTH: Minimum 32 characters
# üîê GENERATION: openssl rand -base64 48 | tr -d '\n' | head -c 32
# ‚ö†Ô∏è  IMPORTANT: Change default 'admin' username in production!
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_GRAFANA_PASSWORD

# ==========================================
# LOGGING
# ==========================================
LOG_LEVEL=info  # debug, info, warning, error
LOG_CHANNEL=stack
LOG_DRIVER=file

# ==========================================
# BACKUP CONFIGURATION
# ==========================================
BACKUP_ENABLED=true
BACKUP_RETENTION_DAYS=30
BACKUP_TIME=02:00  # Daily backup time (UTC)

# S3/Cloud Storage (Optional)
# üîí ROTATION: Every 90 days minimum (critical for backups)
# üìè LENGTH: Access keys are 20 chars, Secret keys are 40 chars
# üîê GENERATION: Create in AWS IAM Console with minimal permissions
# üõ°Ô∏è  SECURITY: Use IAM role with least privilege (backup-only permissions)
# üí° TIP: Consider using AWS KMS for encryption at rest
BACKUP_S3_ENABLED=false
BACKUP_S3_BUCKET=your-backup-bucket
AWS_ACCESS_KEY_ID=CHANGE_ME_AWS_ACCESS_KEY
AWS_SECRET_ACCESS_KEY=CHANGE_ME_AWS_SECRET_KEY
AWS_REGION=us-east-1

# ==========================================
# GAME CONFIGURATION
# ==========================================
DEFAULT_GAME_SPEED=1
DEFAULT_ROUND_LENGTH=365
AUTO_REINSTALL=false
AUTO_REINSTALL_START_AFTER=86400

# ==========================================
# PERFORMANCE TUNING
# ==========================================
# Database Connection Pooling
DB_POOL_MIN=2
DB_POOL_MAX=10

# Query Timeout
DB_QUERY_TIMEOUT=30

# ==========================================
# DEVELOPMENT/DEBUG (Disable in Production)
# ==========================================
DEV_MODE=false
SQL_DEBUG=false
API_DEBUG=false
SHOW_ERRORS=false

# ==========================================
# TIMEZONE
# ==========================================
TZ=UTC

# ==========================================
# DOCKER-SPECIFIC
# ==========================================
COMPOSE_PROJECT_NAME=travian
COMPOSE_FILE=docker-compose.yml:docker-compose.workers.yml

# ==========================================
# HEALTH CHECK CONFIGURATION
# ==========================================
HEALTHCHECK_INTERVAL=60
HEALTHCHECK_TIMEOUT=10
HEALTHCHECK_RETRIES=3
